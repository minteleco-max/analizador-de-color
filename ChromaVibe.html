<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Color Personal Profesional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
        }

        .container {
            flex: 1;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .professional-notice {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            color: white;
            backdrop-filter: blur(10px);
        }

        .professional-notice h3 {
            margin-bottom: 10px;
            color: #FFD93D;
        }

        .professional-notice ul {
            list-style: none;
            padding-left: 0;
        }

        .professional-notice li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .professional-notice li::before {
            content: '💡';
            position: absolute;
            left: 0;
        }

        .light-checker {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .light-checker::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #FFD93D, #FF6B6B, #6BCF7F);
        }

        .light-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .light-indicator.good {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .light-indicator.warning {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ffcc02;
        }

        .light-indicator.bad {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .camera-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .camera-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f, #4ecdc4, #45b7d1);
        }

        #videoContainer {
            position: relative;
            width: 100%;
            max-width: 350px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            background: #f0f0f0;
        }

        #video {
            width: 100%;
            height: auto;
            display: block;
            transform: scaleX(-1);
        }

        #canvas {
            display: none;
        }

        .analysis-zones {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .zone-overlay {
            position: absolute;
            border: 2px solid;
            border-radius: 50%;
            display: none;
            animation: pulse 2s infinite;
        }

        .face-zone {
            border-color: #FF6B6B;
            box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.3);
        }

        .eye-zone {
            border-color: #45B7D1;
            box-shadow: 0 0 0 2px rgba(69, 183, 209, 0.3);
        }

        .hair-zone {
            border-color: #6BCF7F;
            box-shadow: 0 0 0 2px rgba(107, 207, 127, 0.3);
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .capture-guide {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .capture-guide h4 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .guide-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .guide-step {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .guide-step .step-number {
            display: inline-block;
            width: 25px;
            height: 25px;
            background: #45B7D1;
            color: white;
            border-radius: 50%;
            line-height: 25px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 160px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #45b7d1, #4ecdc4);
            color: white;
            box-shadow: 0 4px 15px rgba(69, 183, 209, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(69, 183, 209, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .btn-tertiary {
            background: linear-gradient(45deg, #FFD93D, #FF8E53);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 217, 61, 0.4);
        }

        .btn-tertiary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 217, 61, 0.6);
        }

        .multi-capture {
            display: none;
            text-align: center;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .capture-counter {
            font-size: 18px;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 10px;
        }

        .results {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            position: relative;
            overflow: hidden;
        }

        .results::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f);
        }

        .analysis-result {
            text-align: center;
            margin-bottom: 25px;
        }

        .season-badge {
            display: inline-block;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .confidence-meter {
            margin: 20px 0;
            text-align: center;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .analysis-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .detail-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .detail-card h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: bold;
            color: #45B7D1;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .color-item {
            text-align: center;
        }

        .color-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 8px;
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            position: relative;
        }

        .color-circle:hover {
            transform: scale(1.1);
        }

        .color-name {
            font-size: 12px;
            font-weight: 500;
            color: #666;
        }

        .color-hex {
            font-size: 10px;
            color: #999;
            font-family: monospace;
        }

        .recommendations {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendations h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .rec-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .rec-tab {
            padding: 8px 16px;
            background: #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .rec-tab.active {
            background: #45B7D1;
            color: white;
        }

        .rec-content {
            display: none;
        }

        .rec-content.active {
            display: block;
        }

        .rec-content ul {
            list-style: none;
        }

        .rec-content li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 30px;
        }

        .rec-content li::before {
            position: absolute;
            left: 0;
            top: 10px;
            font-size: 16px;
        }

        .clothing-rec li::before { content: '👔'; }
        .makeup-rec li::before { content: '💄'; }
        .metals-rec li::before { content: '💎'; }
        .avoid-rec li::before { content: '❌'; }

        .professional-disclaimer {
            background: #fff3e0;
            border: 1px solid #ffcc02;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .professional-disclaimer h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }

        .professional-disclaimer p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
        }

        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #45b7d1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 250px;
                min-width: auto;
            }

            .analysis-details {
                grid-template-columns: 1fr;
            }

            .guide-steps {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Analizador de Color Personal Profesional</h1>
            <p>Basado en la teoría estacional de análisis colorimétrico</p>
        </div>

        <div class="professional-notice">
            <h3>📚 Fundamentos Profesionales</h3>
            <ul>
                <li>Basado en la teoría de Johannes Itten y Suzanne Caygill</li>
                <li>Análisis de temperatura, intensidad y claridad cromática</li>
                <li>Herramienta orientativa - No sustituye consulta profesional</li>
                <li>Mejor resultado con luz natural difusa</li>
            </ul>
        </div>

        <div class="light-checker">
            <h3 style="text-align: center; margin-bottom: 20px;">🌟 Control de Iluminación</h3>
            <div id="lightIndicator" class="light-indicator warning">
                <span id="lightIcon">⚠️</span>
                <span id="lightText">Verificando condiciones de luz...</span>
            </div>
            <p style="text-align: center; color: #666; font-size: 14px;">
                Para mejores resultados, usa luz natural cerca de una ventana sin sol directo
            </p>
        </div>

        <div class="camera-section">
            <div id="status" class="status info">
                Presiona "Iniciar Cámara" para comenzar el análisis profesional
            </div>

            <div class="capture-guide" id="captureGuide" style="display: none;">
                <h4>📋 Guía de Captura Profesional</h4>
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div>Rostro limpio sin maquillaje</div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div>Cabello visible y natural</div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div>Luz natural difusa</div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">4</div>
                        <div>Posición centrada</div>
                    </div>
                </div>
            </div>

            <div id="videoContainer">
                <video id="video" autoplay muted playsinline></video>
                <div class="analysis-zones">
                    <div id="faceZone" class="zone-overlay face-zone"></div>
                    <div id="eyeZone" class="zone-overlay eye-zone"></div>
                    <div id="hairZone" class="zone-overlay hair-zone"></div>
                </div>
            </div>
            <canvas id="canvas"></canvas>

            <div id="multiCapture" class="multi-capture">
                <div class="capture-counter">Toma <span id="currentCapture">1</span> de 3</div>
                <p>Cambia ligeramente el ángulo para mayor precisión</p>
            </div>

            <div class="controls">
                <button id="startCamera" class="btn-primary">Iniciar Cámara</button>
                <button id="capture" class="btn-secondary" style="display: none;">Analizar (1/3)</button>
                <button id="multiAnalyze" class="btn-tertiary" style="display: none;">Análisis Completo</button>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p id="loadingText">Analizando tu coloración personal...</p>
            </div>
        </div>

        <div id="results" class="results">
            <div class="analysis-result">
                <div id="seasonBadge" class="season-badge"></div>
                <p id="seasonDescription"></p>
                
                <div class="confidence-meter">
                    <p><strong>Nivel de Confianza del Análisis</strong></p>
                    <div class="confidence-bar">
                        <div id="confidenceBar" class="confidence-fill"></div>
                    </div>
                    <small id="confidenceText"></small>
                </div>
            </div>

            <div class="analysis-details">
                <div class="detail-card">
                    <h4>Temperatura</h4>
                    <div id="temperatureValue" class="detail-value">-</div>
                </div>
                <div class="detail-card">
                    <h4>Intensidad</h4>
                    <div id="intensityValue" class="detail-value">-</div>
                </div>
                <div class="detail-card">
                    <h4>Claridad</h4>
                    <div id="clarityValue" class="detail-value">-</div>
                </div>
            </div>

            <h3 style="text-align: center; margin-bottom: 20px;">🎨 Tu Paleta Personal</h3>
            <div class="color-palette" id="colorPalette"></div>

            <div class="recommendations">
                <h3>💡 Recomendaciones Profesionales</h3>
                <div class="rec-tabs">
                    <div class="rec-tab active" data-tab="clothing">Ropa</div>
                    <div class="rec-tab" data-tab="makeup">Maquillaje</div>
                    <div class="rec-tab" data-tab="metals">Metales</div>
                    <div class="rec-tab" data-tab="avoid">Evitar</div>
                </div>
                
                <div id="clothingRec" class="rec-content active clothing-rec">
                    <ul id="clothingList"></ul>
                </div>
                <div id="makeupRec" class="rec-content makeup-rec">
                    <ul id="makeupList"></ul>
                </div>
                <div id="metalsRec" class="rec-content metals-rec">
                    <ul id="metalsList"></ul>
                </div>
                <div id="avoidRec" class="rec-content avoid-rec">
                    <ul id="avoidList"></ul>
                </div>
            </div>

            <div class="professional-disclaimer">
                <h4>⚠️ Aviso Profesional</h4>
                <p>Este análisis es orientativo y se basa en algoritmos automatizados. Para un análisis colorimétrico completo y profesional, se recomienda consultar con un asesor de imagen certificado que pueda evaluar tu coloración bajo condiciones controladas de iluminación y con referencias físicas calibradas.</p>
            </div>
        </div>
    </div>

    <script>
        class ProfessionalColorAnalyzer {
            constructor() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.isAnalyzing = false;
                this.captures = [];
                this.currentCaptureIndex = 0;
                this.maxCaptures = 3;
                this.lightQuality = 0;
                
                this.colorSeasons = {
                    spring: {
                        name: 'Primavera Cálida',
                        colors: ['#FF6B6B', '#FFD93D', '#6BCF7F', '#FF8E53', '#4ECDC4', '#45B7D1', '#FFA726', '#AB47BC'],
                        colorNames: ['Coral Vibrante', 'Amarillo Dorado', 'Verde Fresco', 'Melocotón', 'Turquesa Claro', 'Azul Cielo', 'Naranja Suave', 'Lila Cálido'],
                        hexCodes: ['#FF6B6B', '#FFD93D', '#6BCF7F', '#FF8E53', '#4ECDC4', '#45B7D1', '#FFA726', '#AB47BC'],
                        badge: 'linear-gradient(45deg, #FFD93D, #FF6B6B)',
                        description: 'Colores cálidos, claros y vibrantes que realzan tu luminosidad natural',
                        temperature: 'Cálida',
                        intensity: 'Clara',
                        clarity: 'Brillante',
                        recommendations: {
                            clothing: [
                                'Colores claros y luminosos cerca del rostro',
                                'Amarillos dorados y naranjas suaves',
                                'Verdes frescos y turquesas claros',
                                'Rosas coral en lugar de rosas fríos',
                                'Marrones cálidos y beiges dorados'
                            ],
                            makeup: [
                                'Bases con subtono cálido/dorado',
                                'Rubores en tonos coral y melocotón',
                                'Labiales coral, naranja suave y rosa cálido',
                                'Sombras en dorados, marrones cálidos y verdes',
                                'Máscaras en marrón en lugar de negro'
                            ],
                            metals: [
                                'Oro amarillo como metal principal',
                                'Bronce y cobre para variedad',
                                'Evita plata fría y platino',
                                'Perlas crema y doradas'
                            ],
                            avoid: [
                                'Colores muy oscuros o apagados',
                                'Negro puro cerca del rostro',
                                'Azules muy fríos',
                                'Rosas fucsia o magenta',
                                'Plata y metales fríos'
                            ]
                        }
                    },
                    summer: {
                        name: 'Verano Suave',
                        colors: ['#B8A9C9', '#87CEEB', '#FFB6C1', '#E6E6FA', '#98FB98', '#F0E68C', '#DDA0DD', '#F5DEB3'],
                        colorNames: ['Lavanda Suave', 'Azul Cielo', 'Rosa Suave', 'Lila Pastel', 'Verde Menta', 'Amarillo Suave', 'Ciruela Claro', 'Beige Rosado'],
                        hexCodes: ['#B8A9C9', '#87CEEB', '#FFB6C1', '#E6E6FA', '#98FB98', '#F0E68C', '#DDA0DD', '#F5DEB3'],
                        badge: 'linear-gradient(45deg, #87CEEB, #B8A9C9)',
                        description: 'Colores suaves, frescos y delicados que complementan tu elegancia natural',
                        temperature: 'Fría',
                        intensity: 'Clara',
                        clarity: 'Suave',
                        recommendations: {
                            clothing: [
                                'Tonos pastel y colores suaves',
                                'Azules frescos y celestes',
                                'Rosas fríos y lavandas',
                                'Grises suaves y blancos puros',
                                'Evita colores muy saturados'
                            ],
                            makeup: [
                                'Bases con subtono rosado o neutro',
                                'Rubores en rosa suave y lavanda',
                                'Labiales rosa frío y berry suave',
                                'Sombras en grises, azules y lilas',
                                'Delineadores en marrón suave o gris'
                            ],
                            metals: [
                                'Plata como metal principal',
                                'Oro blanco y platino',
                                'Evita oro amarillo',
                                'Perlas blancas y grises'
                            ],
                            avoid: [
                                'Colores muy brillantes o intensos',
                                'Naranjas y amarillos dorados',
                                'Oro amarillo',
                                'Contrastes muy fuertes',
                                'Colores tierra muy cálidos'
                            ]
                        }
                    },
                    autumn: {
                        name: 'Otoño Profundo',
                        colors: ['#D2691E', '#CD853F', '#A0522D', '#8B4513', '#DAA520', '#B22222', '#228B22', '#800080'],
                        colorNames: ['Naranja Tierra', 'Arena Dorada', 'Marrón Medio', 'Chocolate', 'Dorado Rico', 'Rojo Ladrillo', 'Verde Bosque', 'Púrpura Profundo'],
                        hexCodes: ['#D2691E', '#CD853F', '#A0522D', '#8B4513', '#DAA520', '#B22222', '#228B22', '#800080'],
                        badge: 'linear-gradient(45deg, #D2691E, #8B4513)',
                        description: 'Tonos ricos, profundos y terrosos que armonizan con tu calidez natural',
                        temperature: 'Cálida',
                        intensity: 'Profunda',
                        clarity: 'Rica',
                        recommendations: {
                            clothing: [
                                'Tonos tierra ricos y profundos',
                                'Naranjas, marrones y dorados',
                                'Rojos cálidos y borgoña',
                                'Verdes bosque y oliva',
                                'Cremas cálidos en lugar de blanco puro'
                            ],
                            makeup: [
                                'Bases con subtono dorado intenso',
                                'Rubores en melocotón profundo y terracota',
                                'Labiales en rojos cálidos, naranjas y marrones',
                                'Sombras en dorados, marrones y verdes oliva',
                                'Delineadores en marrón chocolate'
                            ],
                            metals: [
                                'Oro amarillo y cobre',
                                'Bronce envejecido',
                                'Evita plata y metales fríos',
                                'Perlas doradas y ámbar'
                            ],
                            avoid: [
                                'Colores muy claros o pasteles',
                                'Azules fríos y grises',
                                'Rosa chicle y fucsia',
                                'Blanco puro',
                                'Plata y metales fríos'
                            ]
                        }
                    },
                    winter: {
                        name: 'Invierno Intenso',
                        colors: ['#000080', '#DC143C', '#800080', '#000000', '#FFFFFF', '#C0C0C0', '#4169E1', '#FF1493'],
                        colorNames: ['Azul Marino', 'Rojo Intenso', 'Púrpura Real', 'Negro Puro', 'Blanco Puro', 'Plata', 'Azul Real', 'Rosa Intenso'],
                        hexCodes: ['#000080', '#DC143C', '#800080', '#000000', '#FFFFFF', '#C0C0C0', '#4169E1', '#FF1493'],
                        badge: 'linear-gradient(45deg, #000080, #DC143C)',
                        description: 'Colores intensos, puros y dramáticos que resaltan tu contraste natural',
                        temperature: 'Fría',
                        intensity: 'Profunda',
                        clarity: 'Intensa',
                        recommendations: {
                            clothing: [
                                'Colores intensos y contrastantes',
                                'Negro, blanco puro y grises',
                                'Azules profundos y rojos intensos',
                                'Púrpuras y magentas vibrantes',
                                'Contrastes dramáticos'
                            ],
                            makeup: [
                                'Bases con subtono rosado o neutro',
                                'Rubores en rosa intenso y berry',
                                'Labiales rojos puros, fucsia y berry',
                                'Sombras en grises, negros y azules',
                                'Delineadores negros intensos'
                            ],
                            metals: [
                                'Plata y platino como principales',
                                'Oro blanco',
                                'Evita oro amarillo cálido',
                                'Perlas blancas puras'
                            ],
                            avoid: [
                                'Colores cálidos y terrosos',
                                'Naranjas y amarillos dorados',
                                'Marrones cálidos',
                                'Colores apagados o sucios',
                                'Oro amarillo'
                            ]
                        }
                    }
                };

                this.initializeEventListeners();
                this.startLightMonitoring();
            }

            initializeEventListeners() {
                document.getElementById('startCamera').addEventListener('click', () => this.startCamera());
                document.getElementById('capture').addEventListener('click', () => this.captureImage());
                document.getElementById('multiAnalyze').addEventListener('click', () => this.performCompleteAnalysis());
                
                // Tabs de recomendaciones
                document.querySelectorAll('.rec-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });
            }

            startLightMonitoring() {
                // Simulación de monitoreo de luz ambiente
                setInterval(() => {
                    this.checkLightConditions();
                }, 2000);
            }

            checkLightConditions() {
                if (!this.video.srcObject) return;

                // Análisis básico de luminosidad de la imagen
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = 100;
                tempCanvas.height = 100;
                
                tempCtx.drawImage(this.video, 0, 0, 100, 100);
                const imageData = tempCtx.getImageData(0, 0, 100, 100);
                const data = imageData.data;
                
                let brightness = 0;
                for (let i = 0; i < data.length; i += 4) {
                    brightness += (data[i] + data[i + 1] + data[i + 2]) / 3;
                }
                brightness = brightness / (data.length / 4);
                
                // Actualizar indicador de luz
                this.updateLightIndicator(brightness);
                this.lightQuality = brightness;
            }

            updateLightIndicator(brightness) {
                const indicator = document.getElementById('lightIndicator');
                const icon = document.getElementById('lightIcon');
                const text = document.getElementById('lightText');
                
                if (brightness > 120 && brightness < 200) {
                    indicator.className = 'light-indicator good';
                    icon.textContent = '✅';
                    text.textContent = 'Condiciones de luz óptimas';
                } else if (brightness >= 80 && brightness <= 220) {
                    indicator.className = 'light-indicator warning';
                    icon.textContent = '⚠️';
                    text.textContent = brightness < 120 ? 'Luz insuficiente - Acércate a ventana' : 'Luz muy intensa - Busca sombra';
                } else {
                    indicator.className = 'light-indicator bad';
                    icon.textContent = '❌';
                    text.textContent = brightness < 80 ? 'Muy oscuro para análisis' : 'Luz demasiado intensa';
                }
            }

            async startCamera() {
                try {
                    this.updateStatus('Iniciando cámara profesional...', 'info');
                    
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: 'user',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    });
                    
                    this.video.srcObject = stream;
                    this.video.style.display = 'block';
                    
                    this.video.onloadedmetadata = () => {
                        this.canvas.width = this.video.videoWidth;
                        this.canvas.height = this.video.videoHeight;
                        
                        document.getElementById('startCamera').style.display = 'none';
                        document.getElementById('capture').style.display = 'inline-block';
                        document.getElementById('captureGuide').style.display = 'block';
                        
                        this.updateStatus('¡Cámara lista! Sigue la guía para captura profesional', 'success');
                        this.startAdvancedFaceDetection();
                    };
                    
                } catch (error) {
                    console.error('Error accessing camera:', error);
                    this.updateStatus('No se pudo acceder a la cámara. Verifica los permisos.', 'error');
                }
            }

            startAdvancedFaceDetection() {
                const videoRect = this.video.getBoundingClientRect();
                const containerRect = document.getElementById('videoContainer').getBoundingClientRect();
                
                // Zona facial (más grande)
                const faceSize = Math.min(videoRect.width, videoRect.height) * 0.5;
                const faceLeft = (containerRect.width - faceSize) / 2;
                const faceTop = (containerRect.height - faceSize) / 2;
                
                const faceZone = document.getElementById('faceZone');
                faceZone.style.width = faceSize + 'px';
                faceZone.style.height = faceSize + 'px';
                faceZone.style.left = faceLeft + 'px';
                faceZone.style.top = faceTop + 'px';
                faceZone.style.display = 'block';
                
                // Zona de ojos
                const eyeSize = faceSize * 0.3;
                const eyeLeft = faceLeft + (faceSize - eyeSize) / 2;
                const eyeTop = faceTop + faceSize * 0.25;
                
                const eyeZone = document.getElementById('eyeZone');
                eyeZone.style.width = eyeSize + 'px';
                eyeZone.style.height = eyeSize * 0.5 + 'px';
                eyeZone.style.left = eyeLeft + 'px';
                eyeZone.style.top = eyeTop + 'px';
                eyeZone.style.display = 'block';
                
                // Zona de cabello
                const hairSize = faceSize * 0.8;
                const hairLeft = faceLeft + (faceSize - hairSize) / 2;
                const hairTop = faceTop - faceSize * 0.2;
                
                const hairZone = document.getElementById('hairZone');
                hairZone.style.width = hairSize + 'px';
                hairZone.style.height = hairSize * 0.4 + 'px';
                hairZone.style.left = hairLeft + 'px';
                hairZone.style.top = hairTop + 'px';
                hairZone.style.display = 'block';
            }

            async captureImage() {
                if (this.isAnalyzing) return;
                
                // Verificar condiciones de luz
                if (this.lightQuality < 80 || this.lightQuality > 220) {
                    this.updateStatus('⚠️ Condiciones de luz no óptimas. Mejora la iluminación antes de continuar.', 'error');
                    return;
                }
                
                this.currentCaptureIndex++;
                
                // Capturar imagen
                this.ctx.drawImage(this.video, 0, 0, this.canvas.width, this.canvas.height);
                const imageData = this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);
                this.captures.push(imageData);
                
                // Actualizar UI
                document.getElementById('currentCapture').textContent = this.currentCaptureIndex;
                document.getElementById('multiCapture').style.display = 'block';
                
                if (this.currentCaptureIndex < this.maxCaptures) {
                    document.getElementById('capture').textContent = `Capturar (${this.currentCaptureIndex + 1}/3)`;
                    this.updateStatus(`Captura ${this.currentCaptureIndex} completada. Cambia el ángulo ligeramente.`, 'success');
                } else {
                    document.getElementById('capture').style.display = 'none';
                    document.getElementById('multiAnalyze').style.display = 'inline-block';
                    this.updateStatus('¡3 capturas completadas! Presiona "Análisis Completo"', 'success');
                }
            }

            async performCompleteAnalysis() {
                if (this.isAnalyzing) return;
                
                this.isAnalyzing = true;
                document.getElementById('loading').style.display = 'block';
                document.getElementById('multiAnalyze').disabled = true;
                
                // Simular análisis avanzado
                const analysisSteps = [
                    'Analizando temperatura cromática...',
                    'Evaluando intensidad de color...',
                    'Determinando claridad y contraste...',
                    'Comparando con base de datos profesional...',
                    'Generando recomendaciones personalizadas...'
                ];
                
                for (let i = 0; i < analysisSteps.length; i++) {
                    document.getElementById('loadingText').textContent = analysisSteps[i];
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                // Analizar múltiples capturas
                const colorAnalysis = this.analyzeMultipleCaptures();
                const season = this.determineProfessionalSeason(colorAnalysis);
                const confidence = this.calculateConfidence(colorAnalysis);
                
                // Mostrar resultados
                this.displayProfessionalResults(season, colorAnalysis, confidence);
                
                document.getElementById('loading').style.display = 'none';
                this.isAnalyzing = false;
            }

            analyzeMultipleCaptures() {
                let totalR = 0, totalG = 0, totalB = 0;
                let totalSamples = 0;
                
                this.captures.forEach(capture => {
                    const data = capture.data;
                    const centerX = capture.width / 2;
                    const centerY = capture.height / 2;
                    const radius = Math.min(capture.width, capture.height) / 8;
                    
                    for (let x = centerX - radius; x < centerX + radius; x += 4) {
                        for (let y = centerY - radius; y < centerY + radius; y += 4) {
                            if (x >= 0 && x < capture.width && y >= 0 && y < capture.height) {
                                const distance = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                                if (distance <= radius) {
                                    const index = (Math.floor(y) * capture.width + Math.floor(x)) * 4;
                                    totalR += data[index];
                                    totalG += data[index + 1];
                                    totalB += data[index + 2];
                                    totalSamples++;
                                }
                            }
                        }
                    }
                });
                
                return {
                    r: Math.floor(totalR / totalSamples),
                    g: Math.floor(totalG / totalSamples),
                    b: Math.floor(totalB / totalSamples)
                };
            }

            determineProfessionalSeason(colorAnalysis) {
                const { r, g, b } = colorAnalysis;
                
                // Análisis más sofisticado
                const brightness = (r + g + b) / 3;
                const warmth = (r - b) / 255;
                const saturation = (Math.max(r, g, b) - Math.min(r, g, b)) / 255;
                const contrast = Math.abs(r - g) + Math.abs(g - b) + Math.abs(r - b);
                
                // Lógica mejorada basada en múltiples factores
                let seasonScore = {
                    spring: 0,
                    summer: 0,
                    autumn: 0,
                    winter: 0
                };
                
                // Análisis de temperatura
                if (warmth > 0.1) {
                    seasonScore.spring += 2;
                    seasonScore.autumn += 2;
                } else {
                    seasonScore.summer += 2;
                    seasonScore.winter += 2;
                }
                
                // Análisis de intensidad
                if (brightness > 160) {
                    seasonScore.spring += 2;
                    seasonScore.summer += 2;
                } else {
                    seasonScore.autumn += 2;
                    seasonScore.winter += 2;
                }
                
                // Análisis de saturación
                if (saturation > 0.3) {
                    seasonScore.spring += 1;
                    seasonScore.winter += 1;
                } else {
                    seasonScore.summer += 1;
                    seasonScore.autumn += 1;
                }
                
                // Análisis de contraste
                if (contrast > 100) {
                    seasonScore.winter += 2;
                    seasonScore.autumn += 1;
                }
                
                // Determinar ganador
                return Object.keys(seasonScore).reduce((a, b) => 
                    seasonScore[a] > seasonScore[b] ? a : b
                );
            }

            calculateConfidence(colorAnalysis) {
                // Calcular confianza basada en calidad de luz y consistencia de capturas
                let confidence = 50; // Base
                
                // Bonus por buena iluminación
                if (this.lightQuality > 120 && this.lightQuality < 200) {
                    confidence += 30;
                } else if (this.lightQuality >= 100 && this.lightQuality <= 220) {
                    confidence += 15;
                }
                
                // Bonus por múltiples capturas
                confidence += this.captures.length * 5;
                
                // Ajustar según saturación (más saturado = más confiable)
                const { r, g, b } = colorAnalysis;
                const saturation = (Math.max(r, g, b) - Math.min(r, g, b)) / 255;
                confidence += saturation * 10;
                
                return Math.min(confidence, 95); // Máximo 95%
            }

            displayProfessionalResults(seasonKey, colorAnalysis, confidence) {
                const season = this.colorSeasons[seasonKey];
                
                // Badge y descripción
                const badge = document.getElementById('seasonBadge');
                badge.textContent = season.name;
                badge.style.background = season.badge;
                
                document.getElementById('seasonDescription').textContent = season.description;
                
                // Barra de confianza
                const confidenceBar = document.getElementById('confidenceBar');
                const confidenceText = document.getElementById('confidenceText');
                
                confidenceBar.style.width = confidence + '%';
                confidenceBar.style.background = confidence > 70 ? '#4CAF50' : confidence > 50 ? '#FF9800' : '#F44336';
                confidenceText.textContent = `${Math.round(confidence)}% - ${confidence > 70 ? 'Alta confiabilidad' : confidence > 50 ? 'Confiabilidad media' : 'Baja confiabilidad'}`;
                
                // Detalles del análisis
                document.getElementById('temperatureValue').textContent = season.temperature;
                document.getElementById('intensityValue').textContent = season.intensity;
                document.getElementById('clarityValue').textContent = season.clarity;
                
                // Paleta de colores
                const palette = document.getElementById('colorPalette');
                palette.innerHTML = '';
                
                season.colors.forEach((color, index) => {
                    const colorItem = document.createElement('div');
                    colorItem.className = 'color-item';
                    colorItem.innerHTML = `
                        <div class="color-circle" style="background-color: ${color}"></div>
                        <div class="color-name">${season.colorNames[index]}</div>
                        <div class="color-hex">${season.hexCodes[index]}</div>
                    `;
                    palette.appendChild(colorItem);
                });
                
                // Recomendaciones por categorías
                this.populateRecommendations(season.recommendations);
                
                // Mostrar resultados
                document.getElementById('results').style.display = 'block';
                this.updateStatus(`¡Análisis profesional completado! Tipo: ${season.name}`, 'success');
                
                // Scroll a resultados
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }

            populateRecommendations(recommendations) {
                // Ropa
                const clothingList = document.getElementById('clothingList');
                clothingList.innerHTML = '';
                recommendations.clothing.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    clothingList.appendChild(li);
                });
                
                // Maquillaje
                const makeupList = document.getElementById('makeupList');
                makeupList.innerHTML = '';
                recommendations.makeup.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    makeupList.appendChild(li);
                });
                
                // Metales
                const metalsList = document.getElementById('metalsList');
                metalsList.innerHTML = '';
                recommendations.metals.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    metalsList.appendChild(li);
                });
                
                // Evitar
                const avoidList = document.getElementById('avoidList');
                avoidList.innerHTML = '';
                recommendations.avoid.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    avoidList.appendChild(li);
                });
            }

            switchTab(tabName) {
                // Desactivar todos los tabs
                document.querySelectorAll('.rec-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.rec-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Activar tab seleccionado
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.getElementById(tabName + 'Rec').classList.add('active');
            }

            updateStatus(message, type) {
                const status = document.getElementById('status');
                status.textContent = message;
                status.className = `status ${type}`;
            }
        }

        // Inicializar la aplicación
        window.addEventListener('load', () => {
            new ProfessionalColorAnalyzer();
        });
    </script>
</body>
</html>